@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@


@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@model IEnumerable<Handyman.Data.Entities.Appointment>

@{
    ViewData["HideNavbar"] = true;
    var providerId = UserManager.GetUserId(User);
}
<nav class="navbar navbar-expand-sm navbar-light bg-black border-bottom shadow-sm mb-3">
    <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav  ms-auto">
                @if (SignInManager.IsSignedIn(User))
                {
                    var userId = UserManager.GetUserId(User);

                    <!-- Profile Button -->
                    <li class="nav-item">
                        <a asp-controller="Provider" asp-action="Profile" asp-route-userId="@userId" class="nav-link btn btn-primary text-white px-3">
                            Profile
                        </a>
                    </li>

                    <!-- Appointment Button -->
                    <li class="nav-item ms-2">
                        <a asp-controller="Provider" asp-action="Appointment" asp-route-providerId="@userId" class="nav-link btn btn-warning text-dark px-3">
                            View Appointments
                        </a>

                    </li>

                    <!-- Logout Button -->
                    <li class="nav-item ms-2">
                        <form method="post" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home")">
                            <button type="submit" class="btn btn-danger text-white px-3">
                                Logout
                            </button>
                        </form>
                    </li>
                }
                else
                {
                    <li class="nav-item ms-2">
                        <a class="nav-link btn btn-danger text-white px-3" asp-area="Identity" asp-page="/Account/Login">
                            Login
                        </a>
                    </li>
                }
            </ul>
        </div>
    </div>
</nav>

<h2>Available Appointments</h2>

<table class="table" id="appointmentsTable">
    <thead>
        <tr>
            <th>Customer</th>
            <th>Address</th>
            <th>Date</th>
            <th>Time</th>
            <th>Notes</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="appointmentBody">
        @foreach (var item in Model)
        {
            <tr id="row-@item.Id">
                <td>@item.PersonName</td>
                <td>@item.Address</td>
                <td>@item.AppointmentDate.ToString("yyyy-MM-dd")</td>
                <td>@item.AppointmentTime</td>
                <td>@item.notes</td>
                <td>@item.Status</td>
                <td>
                    <form method="post" asp-action="AcceptAppointment">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="appointmentId" value="@item.Id" />
                        <input type="hidden" name="providerId" value="@providerId" />
                        <button type="submit" class="btn btn-success">Accept</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

